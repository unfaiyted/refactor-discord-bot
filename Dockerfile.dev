# Development Dockerfile with hot reloading
FROM imbios/bun-node:latest-22-debian

WORKDIR /app

# Install development dependencies
RUN apt-get update && apt-get install -y \
    openssl \
    curl \
    bash \
    git \
    && rm -rf /var/lib/apt/lists/*

# Copy package files
COPY package.json ./
COPY bun.lock* ./

# Install ALL dependencies (including devDependencies for development)
RUN bun install

# Copy Prisma schema and generate client
# Note: In dev mode, prisma is mounted as volume but we need initial generation
COPY prisma ./prisma
RUN bunx prisma generate

# Create data directory for SQLite cache
RUN mkdir -p /app/data

# Source code will be mounted as volumes in docker-compose.override.yml
# This allows for hot reloading without rebuilding the container

# Expose port (not strictly needed for Discord bot, but useful for potential webhooks)
EXPOSE 3000

# Development command with hot reload
# Bun's --watch flag automatically restarts on file changes
CMD ["bun", "--watch", "src/index.ts"]
