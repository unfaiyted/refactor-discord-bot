# Docker Compose override for local development
# This file is automatically used by docker-compose when present
# It overrides settings in docker-compose.yml for development workflow

services:
  bot:
    # Use development build target from unified Dockerfile
    build:
      context: .
      dockerfile: Dockerfile
      target: development # Use development build target

    # Mount source code as volumes for hot reloading
    # Changes to these files will immediately reflect in the container
    volumes:
      - ./src:/app/src # Application source code
      - ./prisma:/app/prisma # Database schema
      - ./tsconfig.json:/app/tsconfig.json # TypeScript config
      - ./bunfig.toml:/app/bunfig.toml # Bun config
      - ./data:/app/data # Mount data directory from host (for bulk imports and cache)

      # Exclude node_modules from mount - use container's version
      - /app/node_modules

    # Override environment variables for development
    # env_file is inherited from docker-compose.yml
    environment:
      # Development-specific overrides
      NODE_ENV: development
      LOG_LEVEL: debug # More verbose logging for development

    # Entrypoint script handles watch mode based on NODE_ENV
    # No command override needed - uses Dockerfile's CMD

    # Use default restart policy for dev (no automatic restart)
    restart: 'no'

  # PostgreSQL port override for development
  # Use custom port 15432 on host to avoid conflicts
  postgres:
    ports:
      - '15432:5432' # Map host port 15432 to container port 5432
